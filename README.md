<img src="logo.png" alt="logo" height="128" />

# JsonHilo.js

[Fully-featured](#features) minimal [modular](#modular) [ultra-fast](#fast) zero-dependency [low-level](#jsonlow) [lossless](#lossless) streaming [JSON](https://json.org) parser with a [high-level interface](#jsonhigh), written in [runtime-independent](#runtime-independent) JavaScript.

<!-- Ultra-fast zero-dependency fully-featured minimal modular low-level lossless streaming [JSON](https://json.org) parser with a high-level interface, written in JavaScript. -->

<img src="tao-json.png" alt="tao-json-logo" height="128" />

A stand-alone part of the [TAO](https://xtao.org)-JSON interoperability project.

<img src="tao-deno.png" alt="tao-deno-logo" height="128" />

Part of the TAO-[Deno](https://deno.land/) project.

## Version

`v0+2021-06-20+beta`

Version `0` from `2021-06-20`, `beta`.

Version `0` means that some of the parser's API might still change before reaching version `1` which will signify a stable API.

However, the event API is mostly stable and **the parser is suitable for use**.

It [passes standards-compliance tests](#standards-compliant) and [performs well in benchmarks](#fast).

## Installation

Not necessary. Import modules directly from [deno.land/x](https://deno.land/x):

```js
import {JsonHigh} from 'https://deno.land/x/jsonhilo@v0+2021-06-20+beta/mod.js'
```

Or from [jsDelivr](https://www.jsdelivr.com/):

```js
import {JsonHigh} from 'https://cdn.jsdelivr.net/gh/tree-annotation/jsonhilo@v0+2021-06-20+beta/mod.js'
```

This should work out of the box in Deno and the browser.

<!-- An easy alternative that will work for all environments is to copy and use [`jsonhilo.bundle.js`](jsonhilo.bundle.js), e.g.:

```
curl https://raw.githubusercontent.com/tree-annotation/json-stream-js/jsonhilo.bundle.js > jsonhilo.bundle.js
```

and then:

```js
import {JsonHigh} from 'jsonhilo.bundle.js'
```

The bundle was obtained with [`deno bundle`](https://deno.land/manual/tools/bundler) and exports the same modules as [`mod.js`](mod.js), all dependencies included. -->

## Quickstart

See a basic example in [`demo.js`](demo.js), pasted below:

```js
import {JsonHigh, JsonHighEventType} from './JsonHigh.js'
const stream = JsonHigh((event) => {
  switch (event.type) {
  case JsonHighEventType.openArray:
  case JsonHighEventType.openObject:
  case JsonHighEventType.closeArray:
  case JsonHighEventType.closeObject:
    console.log(event.type)
    break
  case JsonHighEventType.key:
    console.log('key:', event.key)
    break
  case JsonHighEventType.value:
    console.log('value:', typeof event.value, event.value)
    break
  }
})
stream.push('{"array": [null, true, false, 1.2e-3, "[demo]"]}')
```

This uses [the simplified high-level interface](#jsonhigh) built on top of the [more powerful low-level core](#jsonlow).

## Features

* TAO-style simple
* Dependency-free
* Minimal
* [Runtime-independent](#runtime-independent)
* [Lossless](#lossless)
* [Modular](#modular)
* [Fast](#fast)
* [Streaming-friendly](#streaming-friendly)
* [Optionally standards-compliant](#standards-compliant)
* [Unicode-compatible](#unicode-compatible)

## Runtime-independent

The code is written in modern JavaScript and relies upon some of its features, standard modules in particular.

Beyond that it does not use any runtime-specific features and should work in any *modern* JavaScript environment. It was tested in Deno, Node.js, and the browser.

## Lossless

Unlike any other known streaming JSON parser, this one provides a [low-level](#jsonlow) interface for *lossless* parsing, i.e. it is possible to recover the *exact* input, including whitespace and string escape sequences, from parser events.

This feature can be used to implement accurate translators from JSON to other representations (in particular [TAO](https://xtao.org)), syntax highlighters, JSON scanners that search for substrings in strings on-the-fly, without first loading them into memory, and more.

## Modular

The library is highly modular with [a fully independent core](#jsonlow), around which various adapters and extensions are built, including [an easy-to-use high-level interface](#jsonhigh).

## JsonLow

The core module is [**`JsonLow.js`**](JsonLow.js). It has no dependencies, so it can be used on its own. It is very minimal and is optimized for performance and accuracy. It provides the most fine-grained control over the parsing process. The events generated by the parser carry enough information to losslessly recreate the input exactly, including whitespace.

## JsonHigh

[**`JsonHigh.js`**](JsonHigh.js) is the high-level module which provides a more convenient interface. It is composed of auxiliary modules and adapters built around the core. It is optimized for convenience and provides similar functionality and granularity to other streaming parsers, such as [clarinet](https://github.com/dscape/clarinet) or [creationix/jsonparse](https://github.com/creationix/jsonparse).

### Events

There are 4 event types without properties which indicate start and end of structures:

* `JsonHighEventType.openArray`: an array started (`[`)
* `JsonHighEventType.closeArray`: an array ended (`]`)
* `JsonHighEventType.openObject`: an object started (`{`)
* `JsonHighEventType.closeObject`: an object ended (`}`)

And 2 event types with a property which capture primitives:

* `JsonHighEventType.key`: an object's key ended. The `key` property of the event contains the key as a JavaScript string.
* `JsonHighEventType.value`: a primitive JSON value ended. The `value` property of the event contains the corresponding JavaScript value: `true`, `false`, `null`, a number, or a string.

## Fast

Preliminary benchmarks show that the low-level parser is on average at least as fast as [clarinet](https://github.com/dscape/clarinet), which is the fastest streaming JSON parser in JavaScript I could find.

## Streaming-friendly

By default the parser is streaming-friendly by accepting the following:

* Multiple consecutive top-level JSON values -- it can read [line-delimited JSON and concatenated JSON](https://en.wikipedia.org/wiki/JSON_streaming), e.g. [JSON Lines](https://jsonlines.org/), [ndjson](http://ndjson.org/). Whitespace-separated primitives are also supported.

* [Trailing commas](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Trailing_commas) -- a single trailing comma in an array or an object generates no errors.

* Zero-length or whitespace-only input -- generates no errors.

## Standards-compliant

The [streaming-friendly features](#streaming-friendly) can be supressed by [**`Ecma404.js`**](Ecma404.js), an adapter module which provides full [ECMA-404](https://www.ecma-international.org/wp-content/uploads/ECMA-404_2nd_edition_december_2017.pdf)/[RFC 8259](https://datatracker.ietf.org/doc/html/rfc8259) compliance.

This is confirmed by passing the full [JSON Parsing Test Suite](https://github.com/nst/JSONTestSuite).

## Unicode-compatible

The [core logic](#jsonlow) operates on Unicode code points -- in line with spec -- rather than code units or characters.

***

Â© 2021 [xtao.org](https://xtao.org)